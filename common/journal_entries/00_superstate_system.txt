je_superstate_system = {
	icon = "gfx/interface/icons/invention_icons/nationalism.dds"

	scripted_button = je_join_superstate_free_trade_zone_button
	scripted_button = je_leave_superstate_free_trade_zone_button
	
	scripted_button = je_join_superstate_customs_union_button
	scripted_button = je_leave_superstate_customs_union_button
	
	scripted_button = je_join_superstate_currency_union_button
	scripted_button = je_leave_superstate_currency_union_button
	
	scripted_button = je_join_superstate_defence_union_button
	scripted_button = je_leave_superstate_defence_union_button
	
	scripted_button = je_join_superstate_political_union_button
	scripted_button = je_leave_superstate_political_union_button
	
	scripted_button = je_create_superstate_final_union_button
	scripted_button = je_join_superstate_final_union_button

	status_desc = {
		first_valid = {
			triggered_desc = {
				desc = superstate_members.tt
				trigger = {
					has_a_superstate_step = yes
				}
			}
			triggered_desc = {
				desc = superstate_aspirants.tt
				trigger = {
					
				}
			}
		}
	}

	is_shown_when_inactive = {
	
		#Possible superstate country
		OR = { 
		
			#European Union
			AND = { 
				country_is_in_europe = yes
				any_primary_culture = {
					has_discrimination_trait = european_heritage
				}
			}
			
			#South American Union
			AND = { 
				country_is_in_south_america = yes
				any_primary_culture = {
					OR = { 
						has_discrimination_trait = european_heritage
						has_discrimination_trait = indigenous_american_heritage
					}
				}
			}
			
		}
		
	}

	possible = {
		
		#Tech researched
		has_technology_researched = tech_geopolitics_2
		
		#THIS is a sovereign democratic country
		is_a_democracy = yes
		is_sufficiently_independent = yes
		is_at_war = no
		
		#Regionalist laws
		OR = { 
			has_law = law_type:law_regionalist_fp
			has_law = law_type:law_globalist_fp
		}
		
	}

	immediate = {
		
		#Set appropriate flag
		if = {
			limit = { 
				country_is_in_europe = yes
				any_primary_culture = {
					has_discrimination_trait = european_heritage
				}
			}
			set_variable = XEU_ambitions
		}
		
		#Set appropriate flag
		if = {
			limit = { 
				country_is_in_south_america = yes
				any_primary_culture = {
					OR = { 
						has_discrimination_trait = european_heritage
						has_discrimination_trait = indigenous_american_heritage
					}
				}
			}
			set_variable = XSA_ambitions
		}
		
		#Count Superstate Members
		count_superstate_members = yes
		
	}
	
	complete = {
	
		is_a_superstate_country_tag = yes
		
	}
	
	on_complete = {
	
		#Prestige from unification
		hidden_effect = {
			remove_modifier = national_pride_modifier
		}
		add_modifier = { 
			name = national_pride_modifier
			years = 10
			is_decaying = yes 
		}
	
	}
	
	fail = {
	
		NAND = { 
		
			is_a_democracy = yes
			is_sufficiently_independent = yes
			
			OR = { 
				has_law = law_type:law_regionalist_fp
				has_law = law_type:law_globalist_fp
			}
			
		}
	
	}
	
	on_fail = {
		
		#Clear superstate ambition and pacts
		remove_variable = XEU_ambitions
		remove_variable = XSA_ambitions
		
		remove_variable = superstate_free_trade_zone
		remove_variable = superstate_customs_union
		remove_variable = superstate_currency_union
		remove_variable = superstate_defence_union
		remove_variable = superstate_political_union
		
		remove_variable = superstate_members
		remove_variable = superstate_members_majority
		
		#Lose relations with Superstate members (also doubles as a display of who is in the bloc)
		if = {
			limit = {
				has_a_superstate_step = yes
			}
			every_country = {
				limit = { 
					shares_same_superstate = yes
					has_a_superstate_step = yes
				}
				change_relations = { 
					country = ROOT
					value = -25
				}
			}
		}
		else = {
			every_country = {
				limit = { 
					shares_same_superstate = yes
				}
				change_relations = { 
					country = ROOT
					value = -5
				}
			}
		}
		
	}

	on_monthly_pulse = {
	
		effect = {
		
			#Count Superstate Members
			count_superstate_members = yes
			
			#Create Free Trade Zone
			if = {
				limit = { 
					has_variable = superstate_free_trade_zone
				}
				create_superstate_free_trade_zone = yes
			}
			
			#Create Customs Union
			if = {
				limit = {
					has_variable = superstate_customs_union
				}
				create_superstate_customs_union = yes
			}
			
			#Create Currency Union
			if = {
				limit = { 
					has_variable = superstate_currency_union
				}
				#create_superstate_currency_union = yes
			}
			
			#Create Defence Union
			if = {
				limit = { 
					has_variable = superstate_defence_union
				}
				create_superstate_defence_union = yes
			}
			
		}
		
	}

	on_yearly_pulse = {
		
		effect = {
			
			#Create Political Union
			if = {
				limit = { 
					has_variable = superstate_political_union 
					has_variable = superstate_members_majority
				}
				harmonise_superstate_member_law = yes
			}
			
			#Create Confederation
			if = {
				limit = { 
					has_variable = superstate_political_union
		
					#Superstate has already been formed
					any_country = {
						shares_same_superstate = yes
						is_a_superstate_country_tag = yes
						NOT = { has_diplomatic_pact = { who = ROOT type = confederal_state is_initiator = yes } }
					}
					
					NOT = { is_a_superstate_country_tag = yes }
				}
				create_superstate_confederation = yes
			}
			
		}
		
	}

	weight = 0

	should_be_pinned_by_default = yes

	transferable = no

	progressbar = no
}